image: docker:stable

before_script:
  #- docker -H tcp://192.168.1.176:2375 info
  - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN $CI_REGISTRY

variables:
  DOCKER_DRIVER: overlay2
  DOCKER_HOST: tcp://localhost:2375

services:
- docker:dind

stages:
#  - build
  - deploy

#build-prod:
#  stage: build
#  script:
#    - docker-compose build
#  only:
#    - master

deploy-prod:
  stage: deploy
  image: docker:stable
  script:
    - docker -H tcp://192.168.1.176:2375 stack deploy -c docker-compose.yml traefik
